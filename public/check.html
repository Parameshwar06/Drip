<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="logo.png">
  <title> SlopeFlow - IoT Farming Solutions </title>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #2e7d32;
      --secondary: #7cb342;
      --accent: #f9a825;
      --light: #f1f8e9;
      --dark: #1b5e20;
      --gray: #f5f5f5;
    }
    /* Dark mode base overrides */
    body.dark {
      background: radial-gradient(1200px 600px at 80% -10%, rgba(76,175,80,0.12), transparent 60%),
                  radial-gradient(900px 500px at -10% 110%, rgba(255,193,7,0.08), transparent 60%),
                  #0e0f10;
      color: #e6e6e6;
    }
    /* Smooth theme transitions */
    body, header, .feature-item, .cta-button, .footer-column a, .social-icons a, footer, .copyright, nav ul li a, .theme-toggle {
      transition: background-color 250ms ease, color 250ms ease, border-color 250ms ease, box-shadow 250ms ease, transform 250ms ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background-color: var(--light);
      color: #333;
      line-height: 1.6;
    }
    /* Component overrides in dark mode */
    body.dark header { background-color: rgba(20,20,22,0.6); backdrop-filter: blur(8px); box-shadow: 0 2px 18px rgba(0,0,0,0.55); border-bottom: 1px solid rgba(255,255,255,0.06); }
    body.dark nav ul li a { color: #e0e0e0; }
    body.dark nav ul li a:hover { color: #a5d6a7; }
    body.dark .feature-item { background: #141416; border: 1px solid rgba(255,255,255,0.06); box-shadow: 0 10px 30px rgba(0,0,0,0.35); }
    body.dark .about-text h3 { color: #e0e0e0; }
    body.dark .section-title { color: #9de8a5; text-shadow: 0 2px 18px rgba(157,232,165,0.15); }
    body.dark .cta-button { background: linear-gradient(135deg, #ffd54f 0%, #ffb300 100%); box-shadow: 0 8px 24px rgba(255, 179, 0, 0.25); }
    body.dark .cta-button:hover { transform: translateY(-1px); box-shadow: 0 10px 30px rgba(255, 179, 0, 0.35); }
    body.dark footer { background: #0b0c0d; color: #e0e0e0; border-top: 1px solid rgba(255,255,255,0.06); }
    body.dark .footer-column ul li a { color: #bbb; }
    body.dark .footer-column ul li a:hover { color: #fff; }
    body.dark .social-icons a { background: rgba(255,255,255,0.06); color: #fff; box-shadow: inset 0 0 0 1px rgba(255,255,255,0.06); }
    body.dark .social-icons a:hover { transform: translateY(-2px); }
    body.dark .copyright { border-top-color: rgba(255,255,255,0.12); }
    /* Hero overlay boost in dark mode */
    .hero::before { content: ""; position: absolute; inset: 0; background: linear-gradient(180deg, rgba(0,0,0,0.35) 0%, rgba(0,0,0,0.35) 35%, rgba(0,0,0,0.45) 100%); pointer-events: none; }
    /* Theme toggle button */
    .theme-toggle {
      background: #333;
      color: #fff;
      border: none;
      padding: 10px 14px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: background 0.3s, transform 0.2s;
    }
    .theme-toggle:hover { background: #000; }
    .theme-toggle:active { transform: translateY(1px); }
    .theme-icon { display: inline-block; transform: scale(1); transition: transform 250ms ease, rotate 300ms ease; }
    body.dark .theme-toggle { background: #e0e0e0; color: #111; box-shadow: 0 6px 20px rgba(0,0,0,0.25); }
    body.dark .theme-toggle:hover { background: #cfcfcf; }

    .container {
      width: 100%;
      max-width: 1300px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* Header Styles */
    header {
      background-color: white;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 0;
    }

    .logo {
      display: flex;
      align-items: center;
    }

    .logo img {
      height: 50px;
      margin-right: 10px;
    }

    .logo h1 {
      color: var(--primary);
      font-size: 24px;
    }

    nav ul {
      display: flex;
      list-style: none;
    }

    nav ul li {
      margin-left: 30px;
    }

    nav ul li a {
      text-decoration: none;
      color: var(--dark);
      font-weight: 500;
      transition: color 0.3s;
    }

    nav ul li a:hover {
      color: var(--secondary);
    }

    .auth-buttons {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .auth-buttons button {
      background: var(--primary);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 500;
      transition: background 0.3s;
    }

    .auth-buttons button:hover {
      background: var(--dark);
    }

    /* Language Selector */
    .lang-select {
      display: flex;
      align-items: center;
      margin-right: 15px;
      position: relative;
    }

    .lang-select select {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 5px;
      background-color: white;
      cursor: pointer;
      appearance: none;
      padding-right: 30px;
    }

    .lang-select i {
      position: absolute;
      right: 10px;
      pointer-events: none;
    }

    /* Voice Button */
    .voice-assist button {
      background: var(--accent);
      color: white;
      border: none;
      padding: 10px;
      border-radius: 50%;
      cursor: pointer;
      transition: background 0.3s;
    }
    .voice-assist button:hover {
      background: #e65100;
    }

    /* Hero Section */
    .hero {
      position: relative;
      width: 100%;
      height: 400px;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      color: white;
    }

    .bg-video {
      position: absolute;
      top: 50%;
      left: 50%;
      min-width: 100%;
      min-height: 100%;
      transform: translate(-50%, -50%);
      object-fit: cover;
      z-index: -1;
    }

    .hero-content {
      position: relative;
      z-index: 1;
    }

    .hero h2 {
      font-size: 3rem;
      margin-bottom: 20px;
    }

    .hero p {
      font-size: 1.2rem;
      max-width: 700px;
      margin: 0 auto 30px;
    }

    .cta-button {
      background: var(--accent);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 5px;
      font-size: 1.1rem;
      cursor: pointer;
      transition: background 0.3s;
    }

    .cta-button:hover {
      background: #e65100;
    }

    /* About Section */
    .about-section {
      padding: 60px 0;
    }

    .section-title {
      text-align: center;
      margin-bottom: 40px;
      color: var(--primary);
      font-size: 2.2rem;
    }

    .about-content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 40px;
      align-items: center;
    }

    .about-image {
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .about-image img {
      width: 100%;
      height: auto;
      display: block;
    }
    .about-image .about-video {
      width: 100%;
      height: auto;
      display: block;
      aspect-ratio: 16 / 9;
      object-fit: cover;
    }
    /* Video audio toggle */
    .video-audio-toggle {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 2;
      background: rgba(0,0,0,0.55);
      color: #fff;
      border: 1px solid rgba(255,255,255,0.25);
      border-radius: 20px;
      padding: 6px 10px;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      transition: background-color 200ms ease, transform 150ms ease;
    }
    .video-audio-toggle:hover { background: rgba(0,0,0,0.7); }
    .video-audio-toggle:active { transform: translateY(1px); }
    .about-image { position: relative; }

    .about-text h3 {
      color: var(--dark);
      margin-bottom: 20px;
      font-size: 1.8rem;
    }

    .about-text p {
      margin-bottom: 15px;
      line-height: 1.8;
    }

    .features-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin-top: 30px;
    }

    .feature-item {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
      transition: transform 0.3s;
    }

    .feature-item:hover {
      transform: translateY(-5px);
    }

    .feature-item i {
      font-size: 2rem;
      color: var(--secondary);
      margin-bottom: 15px;
    }

    .feature-item h4 {
      color: var(--dark);
      margin-bottom: 10px;
    }

    /* Footer */
    footer {
      background: var(--dark);
      color: white;
      padding: 60px 0 30px;
    }

    .footer-content {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 30px;
      margin-bottom: 40px;
    }

    .footer-column h3 {
      font-size: 1.3rem;
      margin-bottom: 20px;
      color: var(--accent);
    }

    .footer-column ul {
      list-style: none;
    }

    .footer-column ul li {
      margin-bottom: 10px;
    }

    .footer-column ul li a {
      color: #ddd;
      text-decoration: none;
      transition: color 0.3s;
    }

    .footer-column ul li a:hover {
      color: white;
    }

    .social-icons {
      display: flex;
      gap: 15px;
      margin-top: 15px;
    }

    #para { font-size: medium; }

    .social-icons a {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      color: white;
      transition: background 0.3s;
    }

    .social-icons a:hover {
      background: var(--primary);
    }

    .copyright {
      text-align: center;
      padding-top: 30px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* Translation loading indicator */
    .translating {
      position: relative;
    }

    .translating::after {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      width: 16px;
      height: 16px;
      margin: -8px 0 0 -8px;
      border: 2px solid #f3f3f3;
      border-top: 2px solid var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        text-align: center;
      }

      nav ul {
        margin: 20px 0;
        flex-wrap: wrap;
        gap: 12px;
      }

      .hero h2 {
        font-size: 2.2rem;
      }

      .auth-buttons {
        display: flex;
        justify-content: center;
        margin-top: 15px;
        flex-wrap: wrap;
        gap: 8px;
      }
      
      .lang-select {
        margin-right: 0;
        margin-bottom: 10px;
      }
      
      .about-content {
        grid-template-columns: 1fr;
      }
      
      .features-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Tablet optimizations */
    @media (max-width: 992px) {
      .hero { height: 340px; }
      .hero h2 { font-size: 2.4rem; }
      .hero p { font-size: 1rem; }
      .logo img { height: 42px; }
      .logo h1 { font-size: 22px; }
      .header-content { gap: 10px; }
    }

    /* Small phones */
    @media (max-width: 576px) {
      .container { padding: 0 14px; }
      .cta-button { padding: 12px 22px; font-size: 1rem; }
      .feature-item { padding: 16px; }
      .section-title { font-size: 1.8rem; }
      .about-text h3 { font-size: 1.3rem; }
      .hero { height: 300px; }
      .hero h2 { font-size: 1.9rem; }
      .hero p { font-size: 0.95rem; }
      .theme-toggle { padding: 8px 12px; }
      .lang-select select { width: 100%; }
    }
  </style>
</head>
<body>
  <!-- Header with Navigation -->
  <header>
    <div class="container">
      <div class="header-content">
        <div class="logo">
          <img src="logo.png" alt="">
          <h1>SlopeFlow</h1>
        </div>

        <!-- Main Navigation -->
        <nav>
          <ul>
            <li><a href="#" data-translate="Home">Home</a></li>
            <li><a href="#about" data-translate="About Us">About Us</a></li>
            <li><a href="#" data-translate="Contact">Contact</a></li>
          </ul>
        </nav>

        <!-- Auth Buttons -->
        <div class="auth-buttons">
          <div class="lang-select">
            <select id="language">
              <option value="en">English</option>
              <option value="hi">Hindi</option>
              <option value="ta">Tamil</option>
              <option value="te">Telugu</option>
              <option value="kn">Kannada</option>
              <option value="fr">French</option>
              <option value="es">Spanish</option>
              <option value="de">German</option>
            </select>
            <i class="fas fa-globe"></i>
          </div>
          <div class="voice-assist">
            <button id="voiceBtn"><i class="fas fa-microphone"></i></button>
          </div>
          <button id="themeToggle" class="theme-toggle" aria-label="Toggle dark mode"><span class="theme-icon" aria-hidden="true">ðŸŒ™</span><span class="theme-label">Dark mode</span></button>
          <button onclick="window.location.href='login.html'" data-translate="Login">Login</button>
          <button onclick="window.location.href='signup.html'" data-translate="Sign Up">Sign Up</button>
        </div>
      </div>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="hero">
    <video autoplay muted loop playsinline class="bg-video">
      <source src="video.mp4" type="video/mp4">
      Your browser does not support HTML5 video.
    </video>

    <div class="hero-content">
      <h2 data-translate="Empowering Farmers with Smart Irrigation">Empowering Farmers with Smart Irrigation</h2>
      <p id="para" data-translate="Save water, cut energy costs, and grow healthier crops using intelligent solar-powered systems.">Save water, cut energy costs, and grow healthier crops using intelligent solar-powered systems.</p>
      <button class="cta-button" data-translate="Get Started">Get Started</button>
    </div>
  </section>

  <!-- About Section -->
  <section id="about" class="about-section container">
    <h2 class="section-title" data-translate="About SlopeFlow">About SlopeFlow</h2>
    
    <div class="about-content">
      <div class="about-image">
        <button id="videoAudioToggle" class="video-audio-toggle" aria-label="Toggle video sound"><span id="videoAudioIcon">ðŸ”‡</span><span id="videoAudioLabel">Sound off</span></button>
        <video id="aboutVideo" class="about-video" autoplay muted loop playsinline controlslist="nodownload noremoteplayback" disablepictureinpicture>
          <source src="animation.mp4" type="video/mp4">
          <source src="video.mp4" type="video/mp4">
          <source src="videoplayback.mp4" type="video/mp4">
          Your browser does not support HTML5 video.
        </video>
      </div>
      
      <div class="about-text">
        <h3 data-translate="Revolutionizing Agriculture in Hilly Regions">Revolutionizing Agriculture in Hilly Regions</h3>
        <p data-translate="SlopeFlow is an innovative IoT-based irrigation solution specifically designed for challenging terrains like hills and slopes. Our system combines solar power, smart sensors, and precision drip irrigation to optimize water usage and increase crop yields in areas where traditional farming methods struggle.">SlopeFlow is an innovative IoT-based irrigation solution specifically designed for challenging terrains like hills and slopes. Our system combines solar power, smart sensors, and precision drip irrigation to optimize water usage and increase crop yields in areas where traditional farming methods struggle.</p>
        
        <p data-translate="The system uses gravity-fed water distribution with pressure compensation to ensure even water distribution across varying elevations. Solar panels power the entire system, making it energy-independent and environmentally friendly.">The system uses gravity-fed water distribution with pressure compensation to ensure even water distribution across varying elevations. Solar panels power the entire system, making it energy-independent and environmentally friendly.</p>
        
        <div class="features-grid">
          <div class="feature-item">
            <i class="fas fa-tint"></i>
            <h4 data-translate="Smart Drip Irrigation"><a href="irrigation1.html"> Drip Irrigation</a></h4>
            <p data-translate="Delivers the right amount of water,at the right time saving every drop while keeping crops healthier and greener.">Delivers the right amount of water,at the right time saving every drop while keeping crops healthier and greener.</p>
          </div>
          
          <div class="feature-item">
            <i class="fas fa-solar-panel"></i>
            <h4 data-translate="Solar Powered"><a href="solarpanel1.html">Solar Powered</a></h4>
            <p data-translate="Powering the farm with the sun -our smart solar panels capture clean energy,fueling pumps,sensors,and irrigation,all while saving costs and the planet">Powering the farm with the sun -our smart solar panels capture clean energy,fueling pumps,sensors,and irrigation,all while saving costs and the planet</p>
          </div>
          
          <div class="feature-item">
            <i class="fas fa-mountain"></i>
            <h4 data-translate="Report"><a href="report.html">Report</a></h4>
            <p data-translate="Your farm at a glance real-time reports turn sensor data into clear insights,helping you tract water,energy and crop health instantly. ">Your farm at a glance real-time reports turn sensor data into clear insights,helping you tract water,energy and crop health instantly.</p>
          </div>
          
          <div class="feature-item">
            <i class="fas fa-microchip"></i>
            <h4 data-translate="IoT Monitoring">IoT Monitoring</h4>
            <p data-translate="Real-time soil moisture and weather data for optimal irrigation">Real-time soil moisture and weather data for optimal irrigation</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="footer-content">
        <div class="footer-column">
          <h3 data-translate="SlopeFlow Solutions">SlopeFlow Solutions</h3>
          <p data-translate="Transforming agriculture in challenging terrains through IoT technology and smart irrigation solutions.">Transforming agriculture in challenging terrains through IoT technology and smart irrigation solutions.</p>
          <div class="social-icons">
            <a href="#"><i class="fab fa-facebook-f"></i></a>
            <a href="#"><i class="fab fa-twitter"></i></a>
            <a href="#"><i class="fab fa-instagram"></i></a>
            <a href="#"><i class="fab fa-linkedin-in"></i></a>
          </div>
        </div>

        <div class="footer-column">
          <h3 data-translate="Quick Links">Quick Links</h3>
          <ul>
            <li><a href="#" data-translate="Home">Home</a></li>
            <li><a href="#about" data-translate="About Us">About Us</a></li>
            <li><a href="#" data-translate="Contact">Contact</a></li>
          </ul>
        </div>

        <div class="footer-column">
          <h3 data-translate="Our Technology">Our Technology</h3>
          <ul>
            <li><a href="#" data-translate="Solar Pump Controllers">Solar Pump Controllers</a></li>
            <li><a href="#" data-translate="Drip Irrigation Systems">Drip Irrigation Systems</a></li>
            <li><a href="#" data-translate="Soil Sensors">Soil Sensors</a></li>
            <li><a href="#" data-translate="Monitoring Dashboard">Monitoring Dashboard</a></li>
          </ul>
        </div>

        <div class="footer-column">
          <h3 data-translate="Contact Us">Contact Us</h3>
          <ul>
            <li><i class="fas fa-map-marker-alt"></i> <span data-translate="123 FarmTech Avenue, AgriZone">123 FarmTech Avenue, AgriZone</span></li>
            <li><i class="fas fa-phone"></i> +1 234 567 8900</li>
            <li><i class="fas fa-envelope"></i> info@slopeflow.com</li>
          </ul>
        </div>
      </div>

      <div class="copyright">
        <p>&copy; 2025 SlopeFlow Solutions. <span data-translate="All rights reserved.">All rights reserved.</span></p>
      </div>
    </div>
  </footer>

  <script>
    // ====================
    // Theme (Dark/Light)
    // ====================
    function applyTheme(theme) {
      const enableDark = theme === 'dark';
      document.body.classList.toggle('dark', enableDark);
      const btn = document.getElementById('themeToggle');
      if (btn) {
        const icon = btn.querySelector('.theme-icon');
        const label = btn.querySelector('.theme-label');
        if (icon) { icon.textContent = enableDark ? 'â˜€ï¸' : 'ðŸŒ™'; icon.style.transform = 'scale(1.15)'; setTimeout(()=>{ icon.style.transform = 'scale(1)'; }, 180); }
        if (label) label.textContent = enableDark ? 'Light mode' : 'Dark mode';
      }
    }
    function initTheme() {
      const saved = localStorage.getItem('theme') || 'light';
      applyTheme(saved);
      const btn = document.getElementById('themeToggle');
      if (btn) {
        btn.addEventListener('click', () => {
          const current = document.body.classList.contains('dark') ? 'dark' : 'light';
          const next = current === 'dark' ? 'light' : 'dark';
          localStorage.setItem('theme', next);
          applyTheme(next);
        });
      }
    }

    // ====================
    // About video audio toggle
    // ====================
    function initAboutVideoAudioToggle(){
      const video = document.getElementById('aboutVideo');
      const btn = document.getElementById('videoAudioToggle');
      if (!video || !btn) return;
      // Apply saved preference (default muted for autoplay)
      const saved = localStorage.getItem('aboutVideoMuted');
      const shouldMute = saved === null ? true : saved === 'true';
      video.muted = shouldMute;
      updateVideoToggleUI(shouldMute);
      btn.addEventListener('click', ()=>{
        const nextMuted = !video.muted;
        video.muted = nextMuted;
        if (!nextMuted) {
          // On first unmute, attempt to play with sound (user gesture already happened)
          video.play && video.play().catch(()=>{});
        }
        localStorage.setItem('aboutVideoMuted', String(nextMuted));
        updateVideoToggleUI(nextMuted);
      });
    }
    function updateVideoToggleUI(isMuted){
      const icon = document.getElementById('videoAudioIcon');
      const label = document.getElementById('videoAudioLabel');
      if (icon) icon.textContent = isMuted ? 'ðŸ”‡' : 'ðŸ”Š';
      if (label) label.textContent = isMuted ? 'Sound off' : 'Sound on';
    }

    // Translation API endpoint
    const apiUrl = "https://api.mymemory.translated.net/get";
    const translationCache = {};
    
    function setElementLoading(element, isLoading) {
      if (isLoading) {
        element.classList.add('translating');
      } else {
        element.classList.remove('translating');
      }
    }
    function setAllLoading(isLoading) {
      const elements = document.querySelectorAll("[data-translate]");
      elements.forEach(el => {
        setElementLoading(el, isLoading);
      });
    }

    async function translateText(text, lang) {
      if (lang === 'en') return text;
      const cacheKey = `${lang}:${text}`;
      if (translationCache[cacheKey]) return translationCache[cacheKey];
      try {
        const response = await fetch(`${apiUrl}?q=${encodeURIComponent(text)}&langpair=en|${lang}`);
        const data = await response.json();
        if (data && data.responseData && data.responseData.translatedText) {
          const translatedText = data.responseData.translatedText;
          translationCache[cacheKey] = translatedText;
          return translatedText;
        } else {
          throw new Error('API translation failed');
        }
      } catch (error) {
        console.warn('API translation failed:', error);
        return text;
      }
    }

    async function translatePage(lang) {
      const elements = document.querySelectorAll("[data-translate]");
      setAllLoading(true);
      for (let el of elements) {
        const originalText = el.getAttribute("data-translate");
        if (lang === "en") {
          el.innerText = originalText;
        } else {
          const translatedText = await translateText(originalText, lang);
          el.innerText = translatedText;
        }
        setElementLoading(el, false);
      }
    }

    document.getElementById("language").addEventListener("change", (e) => {
      const lang = e.target.value;
      translatePage(lang);
      localStorage.setItem('preferredLanguage', lang);
    });

    document.addEventListener('DOMContentLoaded', function() {
      initTheme();
      initAboutVideoAudioToggle();
      const savedLang = localStorage.getItem('preferredLanguage');
      if (savedLang && savedLang !== 'en') {
        document.getElementById('language').value = savedLang;
        translatePage(savedLang);
      }
    });

    // ====================
// Voice Assistance + Gemini Chatbot
// ====================
document.addEventListener('DOMContentLoaded', function() {
  const voiceBtn = document.getElementById("voiceBtn");
  const languageSelector = document.getElementById("language");

  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  const recognition = new SpeechRecognition();

  recognition.continuous = false;
  recognition.interimResults = false;

  // Language Map for better voice accuracy
  const langMap = {
    en: "en-US",
    hi: "hi-IN",
    ta: "ta-IN",
    te: "te-IN",
    kn: "kn-IN",
    fr: "fr-FR",
    es: "es-ES",
    de: "de-DE"
  };

  // Gemini backend integration
  async function callGeminiAPI(query) {
    try {
      const response = await fetch('http://localhost:3001/api/gemini', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ prompt: query })
      });
      const data = await response.json();
      return data.text;
    } catch (error) {
      console.error('Gemini backend error:', error);
      return "Sorry, I couldn't get a response from Gemini.";
    }
  }

  // Chatbot DOM elements
  const chatbotPopup = document.getElementById('chatbotPopup');
  const chatbotMessages = document.getElementById('chatbotMessages');
  const chatbotInput = document.getElementById('chatbotInput');
  const chatbotSend = document.getElementById('chatbotSend');
  const closeChatbot = document.getElementById('closeChatbot');

  // Show chatbot when mic is pressed and start listening
  voiceBtn.addEventListener("click", () => {
    chatbotPopup.style.display = 'block';
    chatbotInput.focus();
    // Start voice recognition
    const lang = languageSelector.value || "en";
    recognition.lang = langMap[lang] || "en-US";
    recognition.start();
  });

  // Close chatbot
  closeChatbot.addEventListener('click', () => {
    chatbotPopup.style.display = 'none';
  });

  // Send message on button click or Enter
  chatbotSend.addEventListener('click', sendChatbotMessage);
  chatbotInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') sendChatbotMessage();
  });

  async function sendChatbotMessage() {
    const userMsg = chatbotInput.value.trim();
    if (!userMsg) return;
    appendChatbotMessage('You', userMsg);
    chatbotInput.value = '';
    appendChatbotMessage('Bot', '<span style="color:#888;">Thinking...</span>');
    const aiText = await callGeminiAPI(userMsg);
    // Replace "Thinking..." with actual response
    chatbotMessages.lastChild.innerHTML = `<b>Bot:</b> ${aiText}`;
    chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
    speakText(aiText, recognition.lang);
  }

  function appendChatbotMessage(sender, text) {
    const msgDiv = document.createElement('div');
    msgDiv.innerHTML = `<b>${sender}:</b> ${text}`;
    chatbotMessages.appendChild(msgDiv);
    chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
  }

  // On Speech Result: fill input and auto-send
  recognition.onresult = (event) => {
    const userSpeech = event.results[0][0].transcript;
    chatbotPopup.style.display = 'block';
    chatbotInput.value = userSpeech;
    sendChatbotMessage();
  };

  function speakText(text, lang = "en-US") {
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = lang;
    speechSynthesis.speak(utterance);
  }

  recognition.onerror = (e) => {
    console.error("Speech recognition error:", e.error);
  };
});
  function appendChatbotMessage(sender, message) {
    const msgDiv = document.createElement('div');
    msgDiv.innerHTML = `<b>${sender}:</b> ${message}`;
    chatbotMessages.appendChild(msgDiv);
    chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
  }

  let currentUtterance = null;

  async function sendChatbotMessage() {
    const userMsg = chatbotInput.value.trim();
    if (!userMsg) return;
    appendChatbotMessage('You', userMsg);
    chatbotInput.value = '';
    appendChatbotMessage('Bot', '<span style="color:#888;">Thinking...</span>');
    const aiText = await callGeminiAPI(userMsg);

    // Replace "Thinking..." with actual response
    chatbotMessages.lastChild.innerHTML = `<b>Bot:</b> ${aiText}`;
    chatbotMessages.scrollTop = chatbotMessages.scrollHeight;

    // Speak the response
    if (speechSynthesis.speaking) speechSynthesis.cancel();
    currentUtterance = new SpeechSynthesisUtterance(aiText);
    speechSynthesis.speak(currentUtterance);
  }

  // Stop voice button
  document.getElementById("stopVoiceBtn").addEventListener("click", () => {
    speechSynthesis.cancel();
  });



  </script>
    <!-- Chatbot Popup -->
  <div id="chatbotPopup" style="display:none; position:fixed; bottom:90px; right:30px; width:340px; max-width:95vw; background:#23272f; color:#f3f3f3; border-radius:14px; box-shadow:0 8px 32px rgba(0,0,0,0.18); z-index:9999; overflow:hidden; border:1px solid #222;">
    <div style="background:#111827; color:#fff; padding:12px 16px; font-weight:600; display:flex; align-items:center; gap:8px;">
      <span style="font-size:1.3em;">ðŸ¤–</span> SlopeFlow Chatbot
      <button id="closeChatbot" style="margin-left:auto; background:none; border:none; color:#fff; font-size:1.2em; cursor:pointer;">&times;</button>
    </div>
    <div id="chatbotMessages" style="padding:16px; height:220px; overflow-y:auto; font-size:1em; background:#181a20;"></div>
    <div style="display:flex; border-top:1px solid #222;">
      <input id="chatbotInput" type="text" placeholder="Type your question..." style="flex:1; border:none; padding:10px; font-size:1em; outline:none; background:#23272f; color:#f3f3f3;">
      <button id="chatbotSend" style="background:#2563eb; color:#fff; border:none; padding:0 18px; font-size:1.1em; cursor:pointer;">âž¤</button>
    </div>
  </div>
<!-- Chatbot Popup -->
<div id="chatbotPopup" style="display:none; position:fixed; bottom:20px; right:20px; width:320px; background:#fff; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.3); overflow:hidden; z-index:2000; font-family:sans-serif;">
  <div style="background:#2e7d32; color:white; padding:10px; display:flex; justify-content:space-between; align-items:center;">
    <span><b>Assistant</b></span>
    <button id="closeChatbot" style="background:none; border:none; color:white; font-size:18px; cursor:pointer;">âœ–</button>
  </div>
  <div id="chatbotMessages" style="max-height:300px; overflow-y:auto; padding:10px; font-size:14px;"></div>
  <div style="display:flex; border-top:1px solid #ddd;">
    <input id="chatbotInput" type="text" placeholder="Type a message..." style="flex:1; border:none; padding:10px; font-size:14px; outline:none;">
    <button id="chatbotSend" style="background:#2e7d32; color:white; border:none; padding:10px 15px; cursor:pointer;">Send</button>
  </div>
  <div style="padding:8px; text-align:center; border-top:1px solid #ddd;">
    <button id="stopVoiceBtn" style="background:#f44336; color:white; border:none; padding:6px 12px; border-radius:5px; cursor:pointer;">Stop Voice</button>
  </div>
</div>

</body>
</html>
